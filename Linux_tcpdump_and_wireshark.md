* [ç›®å½•](#0)
  * [tcpdump](#1)
  * [Wireshark](#2)

<h3 id="1">tcpdump</h3>

http://www.ha97.com/4550.html

https://blog.51cto.com/victor1980/701764

é•¿å‚æ•°ç¤ºä¾‹  

```
tcpdump -i any src host 192.168.10.2 and dst host 192.168.10.3 and dst port 22  -e -v -tttt -n -nn -c 10 -S
```

é€‰ç”¨çš„å‚æ•°å«ä¹‰ä»‹ç»:  

| å‚æ•°                               | è¯´æ˜                                 |  
|----------------------------------|------------------------------------|   
| -c                               | åœ¨æ”¶åˆ°æŒ‡å®šçš„æ•°é‡çš„åˆ†ç»„åï¼Œtcpdumpå°±ä¼šåœæ­¢ã€‚          |  
| -e                               | åœ¨è¾“å‡ºè¡Œæ‰“å°å‡ºæ•°æ®é“¾è·¯å±‚çš„å¤´éƒ¨ä¿¡æ¯ã€‚                 |
| -i                               | æŒ‡å®šç›‘å¬çš„ç½‘ç»œæ¥å£ã€‚                         |
| -n                               | ä¸æŠŠç½‘ç»œåœ°å€è½¬æ¢æˆåå­—ã€‚                       |
| -nn                              | ä¸è¿›è¡Œç«¯å£åç§°çš„è½¬æ¢ã€‚                        |  
| -v                               | è¾“å‡ºä¸€ä¸ªç¨å¾®è¯¦ç»†çš„ä¿¡æ¯ï¼Œä¾‹å¦‚åœ¨ipåŒ…ä¸­å¯ä»¥åŒ…æ‹¬ttlå’ŒæœåŠ¡ç±»å‹çš„ä¿¡æ¯ |  
| -tttt |   åœ¨æ¯ä¸€è¡Œä¸­è¾“å‡ºç”±dateå¤„ç†çš„é»˜è®¤æ ¼å¼çš„æ—¶é—´æˆ³ã€‚         |
|-S  |   è¾“å‡ºtcpçª—å£åºå·çš„ç»å¯¹å€¼è€Œä¸æ˜¯ç›¸å¯¹å€¼ (manæ‰‹å†Œ: Print absolute, rather than relative, TCP sequence numbers.)|  

å…¶ä¸­:  
tcpdumpä¸­çš„ æº / ç›®æ ‡ åœ°å€, æº / ç›®æ ‡ ç«¯å£, åè®® ä½¿ç”¨ä¸ / æˆ– / é å…³é”®è¯è¿æ¥, å…³äºtcpdumpçš„è¡¨è¾¾å¼ä»‹ç»å¦‚ä¸‹


##### æ’é™¤ç‰¹å®šåœ°å€

å½“æˆ‘å¯èƒ½éœ€è¦æ’é™¤æŸä¸ªåœ°å€æ—¶

```
[root@CQ-KVM-01 ~]# tcpdump -i any dst host 192.168.2.63 and src host \!192.168.2.60 and dst port 22  -e -v -tttt -n -nn -S
dropped privs to tcpdump
tcpdump: listening on any, link-type LINUX_SLL (Linux cooked v1), capture size 262144 bytes
2024-07-26 10:34:50.935994  In 50:0f:f5:6f:02:90 ethertype IPv4 (0x0800), length 68: (tos 0x68, ttl 120, id 59161, offset 0, flags [DF], proto TCP (6), length 52)
    123.147.247.146.49520 > 192.168.2.63.22: Flags [S], cksum 0xf352 (correct), seq 394818068, win 64240, options [mss 1360,nop,wscale 8,nop,nop,sackOK], length 0
2024-07-26 10:34:51.938026  In 50:0f:f5:6f:02:90 ethertype IPv4 (0x0800), length 68: (tos 0x68, ttl 120, id 59166, offset 0, flags [DF], proto TCP (6), length 52)
    123.147.247.146.49520 > 192.168.2.63.22: Flags [S], cksum 0xf352 (correct), seq 394818068, win 64240, options [mss 1360,nop,wscale 8,nop,nop,sackOK], length 0
2024-07-26 10:34:53.955759  In 50:0f:f5:6f:02:90 ethertype IPv4 (0x0800), length 68: (tos 0x68, ttl 120, id 59204, offset 0, flags [DF], proto TCP (6), length 52)
    123.147.247.146.49520 > 192.168.2.63.22: Flags [S], cksum 0xf352 (correct), seq 394818068, win 64240, options [mss 1360,nop,wscale 8,nop,nop,sackOK], length 0
^C
3 packets captured
3 packets received by filter
0 packets dropped by kernel
```

æ’é™¤çš„è¯­æ³•, åœ¨ ```tcpdump``` é‡Œæ˜¯ ```!```  
ç”±äº ```!``` åœ¨shellé‡Œæ˜¯å†…ç½®å˜é‡, å¦æœ‰å«ä¹‰  
æ‰€ä»¥åœ¨ shell ç¯å¢ƒä¸‹æ‰§è¡Œè¿˜éœ€è¦åŠ ä¸Šè½¬ä¹‰ç¬¦, å³ ```\!```

#### tcpdump çš„è¡¨è¾¾å¼ä»‹ç»  

è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œtcpdumpåˆ©ç”¨å®ƒä½œä¸ºè¿‡æ»¤æŠ¥æ–‡çš„æ¡ä»¶ï¼Œå¦‚æœä¸€ä¸ªæŠ¥æ–‡æ»¡è¶³è¡¨ è¾¾å¼çš„æ¡ä»¶ï¼Œåˆ™è¿™ä¸ªæŠ¥æ–‡å°†ä¼šè¢«æ•è·ã€‚å¦‚æœæ²¡æœ‰ç»™å‡ºä»»ä½•æ¡ä»¶ï¼Œåˆ™ç½‘ç»œä¸Šæ‰€æœ‰çš„ä¿¡æ¯åŒ… å°†ä¼šè¢«æˆªè·ã€‚  
åœ¨è¡¨è¾¾å¼ä¸­ä¸€èˆ¬å¦‚ä¸‹å‡ ç§ç±»å‹çš„å…³é”®å­—ï¼š  
ç¬¬ä¸€ç§æ˜¯å…³äºç±»å‹çš„å…³é”®å­—ï¼Œä¸»è¦åŒ…æ‹¬hostï¼Œnetï¼Œportï¼Œä¾‹å¦‚ host 210.27.48.2ï¼Œ æŒ‡æ˜ 210.27.48.2æ˜¯ä¸€å°ä¸»æœºï¼Œnet 202.0.0.0æŒ‡æ˜202.0.0.0æ˜¯ä¸€ä¸ªç½‘ç»œåœ°å€ï¼Œport 23 æŒ‡æ˜ç«¯å£å·æ˜¯23ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šç±»å‹ï¼Œç¼ºçœçš„ç±»å‹æ˜¯hostã€‚  
ç¬¬äºŒç§æ˜¯ç¡®å®šä¼ è¾“æ–¹å‘çš„å…³é”®å­—ï¼Œä¸»è¦åŒ…æ‹¬srcï¼Œdstï¼Œdst or srcï¼Œdst and srcï¼Œ è¿™äº›å…³é”®å­—æŒ‡æ˜äº†ä¼ è¾“çš„æ–¹å‘ã€‚ä¸¾ä¾‹è¯´æ˜ï¼Œsrc 210.27.48.2 ï¼ŒæŒ‡æ˜ipåŒ…ä¸­æºåœ°å€æ˜¯ 210.27.48.2 ï¼Œ dst net 202.0.0.0 æŒ‡æ˜ç›®çš„ç½‘ç»œåœ°å€æ˜¯202.0.0.0ã€‚å¦‚æœæ²¡æœ‰æŒ‡æ˜ æ–¹å‘å…³é”®å­—ï¼Œåˆ™ç¼ºçœæ˜¯src or dstå…³é”®å­—ã€‚  
ç¬¬ä¸‰ç§æ˜¯åè®®çš„å…³é”®å­—ï¼Œä¸»è¦åŒ…æ‹¬fddiï¼Œipï¼Œarpï¼Œrarpï¼Œtcpï¼Œudpç­‰ç±»å‹ã€‚FddiæŒ‡æ˜æ˜¯åœ¨FDDI (åˆ†å¸ƒå¼å…‰çº¤æ•°æ®æ¥å£ç½‘ç»œ)ä¸Šçš„ç‰¹å®šçš„ç½‘ç»œåè®®ï¼Œå®é™…ä¸Šå®ƒæ˜¯â€etherâ€çš„åˆ«åï¼Œfddiå’Œether å…·æœ‰ç±»ä¼¼çš„æºåœ°å€å’Œç›®çš„åœ°å€ï¼Œæ‰€ä»¥å¯ä»¥å°†fddiåè®®åŒ…å½“ä½œetherçš„åŒ…è¿›è¡Œå¤„ç†å’Œåˆ†æã€‚ å…¶ä»–çš„å‡ ä¸ªå…³é”®å­—å°±æ˜¯æŒ‡æ˜äº†ç›‘å¬çš„åŒ…çš„åè®®å†…å®¹ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šä»»ä½•åè®®ï¼Œåˆ™tcpdump å°†ä¼š ç›‘å¬æ‰€æœ‰åè®®çš„ä¿¡æ¯åŒ…ã€‚  
é™¤äº†è¿™ä¸‰ç§ç±»å‹çš„å…³é”®å­—ä¹‹å¤–ï¼Œå…¶ä»–é‡è¦çš„å…³é”®å­—å¦‚ä¸‹ï¼šgatewayï¼Œ broadcastï¼Œlessï¼Œ greaterï¼Œ è¿˜æœ‰ä¸‰ç§é€»è¾‘è¿ç®—ï¼Œå–éè¿ç®—æ˜¯ â€˜not â€˜ â€˜! â€˜ï¼Œ ä¸è¿ç®—æ˜¯â€™andâ€™ï¼Œâ€™&&â€™;æˆ–è¿ç®—æ˜¯â€™orâ€™ ï¼Œâ€™&#124;&#124;â€™ï¼› è¿™äº›å…³é”®å­—å¯ä»¥ç»„åˆèµ·æ¥æ„æˆå¼ºå¤§çš„ç»„åˆæ¡ä»¶æ¥æ»¡è¶³äººä»¬çš„éœ€è¦ã€‚

- â€œä¸â€ æ¡ä»¶ï¼ˆANDï¼‰

```shell
# æŠ“å–æ¥è‡ª 192.168.1.100 ä¸”ç›®æ ‡ç«¯å£ä¸º 22 çš„ TCP åŒ…
tcpdump -i eth0 host 192.168.1.100 and port 22

# ç­‰ä»·å†™æ³•ï¼ˆç”¨ &&ï¼‰
tcpdump -i eth0 host 192.168.1.100 && port 22
```

- â€œæˆ–â€ æ¡ä»¶ï¼ˆORï¼‰

```shell
# æŠ“å–ç«¯å£ä¸º 80 æˆ– 443 çš„æµé‡
tcpdump -i eth0 port 80 or port 443

# ç­‰ä»·å†™æ³•ï¼ˆç”¨ ||ï¼Œä½†éœ€æ³¨æ„ shell è½¬ä¹‰ï¼‰
tcpdump -i eth0 'port 80 || port 443'
```

- â€œéâ€ æ¡ä»¶ï¼ˆNOTï¼‰

```shell
# æŠ“å–ä¸æ˜¯æ¥è‡ª 10.0.0.1 çš„æ‰€æœ‰åŒ…ï¼ˆæ¨èç”¨ notï¼‰
tcpdump -i eth0 not host 10.0.0.1

# å¦‚æœç”¨ !ï¼Œå¿…é¡»åŠ å¼•å·æˆ–è½¬ä¹‰ï¼ˆé¿å… shell å¹²æ‰°ï¼‰
tcpdump -i eth0 '!' host 10.0.0.1
# æˆ–
tcpdump -i eth0 \! host 10.0.0.1
```

ğŸ”’ ä¼˜å…ˆçº§ä¸æ‹¬å·

- ä¼˜å…ˆçº§ï¼šnot > and > or
- ä½¿ç”¨æ‹¬å· () æ§åˆ¶é€»è¾‘åˆ†ç»„ï¼ˆå¿…é¡»åŠ å¼•å·æˆ–è½¬ä¹‰ï¼‰

```shell
# æŠ“å– (æºæ˜¯ A æˆ– B) ä¸” ç›®æ ‡ç«¯å£æ˜¯ 22
tcpdump -i eth0 \( host 192.168.1.10 or host 192.168.1.11 \) and port 22

# æˆ–ç”¨å•å¼•å·åŒ…è£¹æ•´ä¸ªè¡¨è¾¾å¼
tcpdump -i eth0 '(host 192.168.1.10 or host 192.168.1.11) and port 22'
```

ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

- ä¼˜å…ˆä½¿ç”¨ notã€andã€orï¼ˆå¯è¯»æ€§æ›´å¥½ï¼Œæ— éœ€æ‹…å¿ƒ shell è½¬ä¹‰ï¼‰
- å¤æ‚è¡¨è¾¾å¼ç”¨å•å¼•å·åŒ…è£¹ï¼Œé¿å… shell å¹²æ‰°ï¼š 

```shell
tcpdump -i eth0 'host 10.0.0.5 and (port 80 or port 443)'
```

- é¿å…ç›´æ¥ä½¿ç”¨ !ã€&&ã€||ï¼Œé™¤éä½ æ˜ç¡®å¤„ç†äº† shell è½¬ä¹‰


#### tcpdump çš„è¾“å‡º  

å°†tcpdumpè¾“å‡ºåˆ°æ–‡ä»¶(è¾“å‡ºåˆ°æ–‡ä»¶æ—¶ï¼Œä¸ä¼šåŒæ—¶è¾“å‡ºåˆ°å±å¹•)ï¼š  
æœ‰ä¸¤ç§é€‰æ‹©ï¼šè¾“å‡ºä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¾“å‡ºä¸ºæ–‡æœ¬æ–‡ä»¶ã€‚

äºŒè¿›åˆ¶æ–‡ä»¶ï¼štcpdump -w <binaryfilename>  
    ä¾‹å¦‚ï¼štcpdump -w dump1.bin

æ–‡æœ¬æ–‡ä»¶ï¼š  tcpdump > <textfilename>  
    ä¾‹å¦‚ï¼štcpdump >dump1.txt

æŸ¥çœ‹tcpdumpç”Ÿæˆçš„æ–‡ä»¶ï¼ŒåŠ ä¸Š-rå‚æ•°ï¼š  
    tcpdump -r <filename>    
    ä¾‹å¦‚ï¼štcpdump -r dump1.bin  
 
åº”ç”¨å®ä¾‹  
https://blog.csdn.net/cbbbc/article/details/48897367  ä¾‹å­ä¸é”™,å­—å°å¾—å‘æŒ‡  
https://arthurchiao.github.io/blog/tcpdump-practice-zh/ 

<h3 id="2">Wireshark</h3>

ä¸‹è½½åœ°å€å’ŒUserGuide  
https://www.wireshark.org/download.html  
https://www.wireshark.org/docs/wsug_html/#ChUseFileMenuSection  

å¦å¤–æ¯”è¾ƒæœ‰æ„æ€çš„åº”ç”¨  
https://blog.csdn.net/lvshaorong/article/details/51382911  
https://4hou.win/wordpress/?p=14421  

Wiresharkæ›´æ”¹æ—¶é—´æ˜¾ç¤ºæ ¼å¼
å°†æ˜¾ç¤ºæ—¶é—´æ›´æ”¹ä¸º"å¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’.å¾®ç§’"---absoulute date ,å®ƒç§°ä¹‹ä¸ºç»å¯¹æ—¶é—´. å¦å¤–è¿˜å¯ä»¥é€‰æ‹©UTCæ ‡å‡†æ—¶é—´

![](/images/b6be90b3gy1gj527oy4wmj210b0mjtb2.jpg)

![](/images/b6be90b3gy1gj527rzy96j20v308ywhm.jpg)

å°†æ˜¾ç¤ºæ—¶é—´æ›´æ”¹ä¸ºç›¸å¯¹æ—¶é—´, æ—¶é—´å€¼æ˜¯ä»ç¬¬1ä¸ªè¢«æ•è·çš„åŒ…ç®—èµ·çš„é—´éš”æ—¶é—´

![](/images/b6be90b3gy1gj527ximhmj210b0mjwgc.jpg)

![](/images/b6be90b3gy1gj52806u52j20t409e40h.jpg)

#### è¿‡æ»¤æ˜¾ç¤º
https://blog.csdn.net/lixiangminghate/article/details/81663628 

ä¸åœ¨tcpdumpä¸­ç­‰ä»·çš„è¿‡æ»¤ æº /ç›®æ ‡ ä¸»æœºåœ°å€å’Œç«¯å£çš„ä½¿ç”¨  
åŒæ ·ä½¿ç”¨ ä¸ / æˆ– / é è¿ç®—ç¬¦  
ä»¥ä¸‹ç¤ºä¾‹åŒ…å« é è¿ç®—ç¬¦çš„ä½¿ç”¨---æˆå¯¹å°æ‹¬å·  
![](/images/b6be90b3gy1gj52832u1uj212g0660ua.jpg)

